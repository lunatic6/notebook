# 1. 基本概念

## 1. 定义

​	计算机网络就是**互联**的，**自治**的计算机集合

- 自治：无主从关系，即一台计算机不能控制另一台计算机
- 互联：通过通信链路互联互通
- 方式：主机间通过交换网络连接在一起

<img src="D:\Desktop\Markdown\mocc计算机网络\交换网络.png" alt="image-20210222184914962" style="zoom:50%;" />

## 2. Internet

1. 全球最大的**交换网络**
2. 为网络应用提供通信服务的通信基础设施
3. 为网络应该提供应用编程的API

<img src="D:\Desktop\Markdown\mocc计算机网络\互联网络.png" alt="image-20210222185205672" style="zoom:50%;" />

## 3. 网络协议

1. 硬件（主机，路由器，通信链路）是计算机网络的基础

2. 计算机网络中数据交换必须遵循事先约定好的规则
   - 例如交通，除了道路还需要交通法规
   - 任何信息的交换都需要规则
3. **定义**：为网络中的数据交换建立的规则、标准或约定
   - 规定了通信实体之间所交换消息的**格式、意义、顺序**以及针对收到信息或发生事件所采取的**动作**

4. 网络协议**三要素**：
   - 语法
     - 数据与控制信息的结构或格式
     - 信号电平
   - 语义
     - 需要发出何种控制信息
     - 完成何种动作以及做出何种响应
     - 差错控制
   - 时序
     - 事件顺序
     - 速度匹配
5. 协议规范了网络中所有信息发送和接受过程

## 4. 计算机网络结构

### 1. 网络边缘

1. 主机（端系统）
   - 位于网络的“边缘”
   - 运行网络应用程序，如web，email
2. 客户/服务器（client/server）应用模型
   - 客户发送请求，接受服务器响应
   - 如Web应用，文件传输FTP应用
3. 对等（peer-peer）应用模型
   - 无（或不仅依赖）专用服务器
   - 如QQ

### 2. 接入网络，物理介质

 1. 将网络边缘接入核心网（边缘路由器）

    - 住宅
    - 机构（学校，企业）
    - 移动

    2. 核心问题

    - 带宽（bps）。注：网络中的带宽指的是数据的每秒传输速率
    - 单款是共享还是独占

    3. 举例

    <img src="D:\Desktop\Markdown\mocc计算机网络\DSL.png" alt="image-20210222191729720" style="zoom:50%;" />

<img src="D:\Desktop\Markdown\mocc计算机网络\电缆网络.png" alt="image-20210222191845613" style="zoom:50%;" />

<img src="D:\Desktop\Markdown\mocc计算机网络\机构接入.png" alt="image-20210222192712805" style="zoom:50%;" />

<img src="D:\Desktop\Markdown\mocc计算机网络\无线接入.png" alt="image-20210222192811639" style="zoom:50%;" />



### 3. 网络核心

1. 互联的路由器网络
2. 网络核心的关键功能：路由+转发

<img src="D:\Desktop\Markdown\mocc计算机网络\路由.png" alt="image-20210222194843368" style="zoom:50%;" />

### 4. Internet结构

<img src="D:\Desktop\Markdown\mocc计算机网络\Internet结构.png" alt="image-20210222195030892" style="zoom:50%;" />

<img src="D:\Desktop\Markdown\mocc计算机网络\Internet结构2.png" alt="image-20210222195307793" style="zoom: 67%;" />



### 5. 数据交换

​	每两台主机之间进行物理链接，就具备了通信的基础。但是这种链接在主机数量巨大时，链路数量为N平方。因此需要交换设备。

​	但如果设备很多，交换设备的端口需要特别大。同时很难保证数量庞大且距离很远的主机都连接到一台交换设备上。为了保证网络的**连通性和规模**，可以把交换设备连接到一起，构建成**交换网络**。



**交换的功能**

- 动态转接
  - 这种链接在多设备中，可以并行进行

<img src="D:\Desktop\Markdown\mocc计算机网络\动态转接.png" alt="image-20210403135807499" style="zoom:50%;" />

- 动态分配传输资源
  - 实现数据从源主机，穿越交换网络，到达目的主机

#### 1. 电路交换

​	最典型的就是**电话网络**

<img src="D:\Desktop\Markdown\mocc计算机网络\电话网络.png" alt="image-20210403140041786" style="zoom:50%;" />

 1. 三个阶段

    - 建立连接（呼叫/电路建立）
    - 通信
    - 释放连接（拆除电路）

    2. 最显著的特点：**独占资源**

    - 两个电话通过过程中建立起的电路所占有的通信资源，比如说信道资源，是不能被第三方共享的
    - 比如打电话，双方都不说话，此时即便没有语音信息传输，该通信占有的电路资源也不能被第三方使用。除非电话挂断。

    3. 通信资源独占，但是物理链路不是独占的。叫做共享中继线（多路复用）

    <img src="D:\Desktop\Markdown\mocc计算机网络\中继线.png" alt="image-20210403140530798" style="zoom: 50%;" />

#### 2. 多路复用

​	实际情况中，许多物理链路的通信能力，远远大于一路通信所需要的通信资源。

<img src="D:\Desktop\Markdown\mocc计算机网络\多路复用.png" alt="image-20210403142528466" style="zoom:50%;" />

 1. **基本原理：**把链路/网络资源（如带宽）划分为“资源片” 

    - 将资源片分配给各路通信
    - 每路通信**独占**分配到的资源片进行通信
    - 资源片可能**闲置**，如打电话双方不说话的场景

    2. 典型的多路复用方法

       1. 频分FDM：各用户占用不同的带宽资源（频率带宽，单位Hz）

         2. 用户分配到这个频带用，通信过程中一直占用此频带

       3. 时分TDM：将时间划分为登场的**时分复用帧**，每个用户在每个TDM帧中占用固定序号的时隙

         4. 每个用户占用的时隙是周期性出现（周期就是TDM帧的长度），只在自己所属的时隙中传输数据

            <img src="D:\Desktop\Markdown\mocc计算机网络\TDM.png" alt="image-20210403143456881" style="zoom:50%;" />

         5. 用户在不同的时间，占用相同的频带

            <img src="D:\Desktop\Markdown\mocc计算机网络\TDM帧.png" alt="image-20210403143401948" style="zoom:50%;" />

       6. 波分WDM（就是光的频分复用）

       7. 码分CDM

         8. 广泛应用于无线链路共享（蜂窝网，卫星通信等）

<img src="D:\Desktop\Markdown\mocc计算机网络\CDM.png" alt="image-20210403143936831" style="zoom: 50%;" />

​			正交保证CDM中，各信道共享通信资源且互不干扰

#### 3. 报文交换和分组交换

 1. **报文**：源（应用）发送**信息整体**

    - 比如：一个文件

2. **分组**：报文拆分出来的一系列相对较小的数据包，通常加头部信息

   - 需要报文的**拆分和重组**，会产生**额外开销**（时间，头部信息），但并不会慢

     <img src="D:\Desktop\Markdown\mocc计算机网络\分组.png" alt="image-20210403154436093" style="zoom:50%;" />

   3. **分组过程**

<img src="D:\Desktop\Markdown\mocc计算机网络\分组交换过程.png" alt="image-20210403160040729" style="zoom:50%;" />

​	当路由器向目的主机转发第一个数据包时，源主机可以**同时**向路由器发送第二个数据包

​	4. 分组交换也称为统计多路复用，**按需共享链路**

<img src="D:\Desktop\Markdown\mocc计算机网络\分组交换多路复用.png" alt="image-20210403160316173" style="zoom: 50%;" />

   	5. **交换方式：存储-转发**
       - 报文交换和分组交换都采用**存储-转发**的交换方式
       - 区别：一个是以完整报文存储转发，一个是以较小分组存储转发

<img src="D:\Desktop\Markdown\mocc计算机网络\存储转发.png" alt="image-20210403160634610" style="zoom:50%;" />

6. **分组交换：传输延迟**

<img src="D:\Desktop\Markdown\mocc计算机网络\传输延迟.png" alt="image-20210403160901565" style="zoom: 33%;" />

 7. **报文vs分组**：只考虑传输延迟，不考虑报文的拆分和重组，也不考虑添加头部信息

    - 报文交换缺点：在中间路由器上需要缓存报文，越大的报文需要的缓存空间越多
    - 举例比较：

    <img src="D:\Desktop\Markdown\mocc计算机网络\报文分组比较.png" alt="image-20210403161615462" style="zoom:50%;" />

    - 报文耗时：需要等到完整报文到达第一个路由器后，再由第一个路由器发到第二个路由器。也就是串行传输<img src="D:\Desktop\Markdown\mocc计算机网络\报文耗时.png" alt="image-20210403161739566" style="zoom:50%;" />

    - 分组耗时：第一个路由器将分组报文发向第二个路由器的同时，源主机可以向第一个路由器发送第二组数据包。也就是并行传输。路由器1500bits缓存即可。

<img src="D:\Desktop\Markdown\mocc计算机网络\分组交换.png" alt="image-20210403162435337" style="zoom:50%;" />

 8. 分组交换报文传输时间

    <img src="D:\Desktop\Markdown\mocc计算机网络\分组传输时间.png" alt="image-20210403164445652" style="zoom:50%;" />

#### 4. 例题

<img src="D:\Desktop\Markdown\mocc计算机网络\分组交换例题.png" alt="image-20210403172415723" style="zoom:50%;" />

<img src="D:\Desktop\Markdown\mocc计算机网络\分组交换例题1解.png" alt="image-20210403172606960" style="zoom:50%;" />

#### 5. 分组交换vs电路交换

​	分组交换允许更多用户同时使用网络，充分共享网络资源

<img src="D:\Desktop\Markdown\mocc计算机网络\分组和电路.png" alt="image-20210403173458657" style="zoom:50%;" />

#### 6. 分组交换小结

 1. 优点：适用于突发数据传输网络

    - 资源充分共享
    - 简单、无需呼叫建立

2. 缺点：可能**产生拥塞**——分组延迟和丢失

   - 需要协议处理可靠数据传输和拥塞控制

3. 提供电路级性能保障也存在不足

   - 例如，音视频应用所需的带宽保障。

   

实现网络互连的传输媒介（如光纤、双绞线、微波等）称为**链路**



## 5. 计算机网络性能

### 1. 速率

1. **定义：**
   - 即数据率/数据传输率/比特率
   - 单位时间传输信息（bit）量
   - 计算机网络中最重要的一个性能指标
2. **单位：**b/s，kb/s，Mb/s，Gb/s，Tb/s
   - 注：计网中的k,M,G,T为10的3,6,9,12次方，而不是2的
3. 速率往往是指**额定速率**或**标称速率**（实际中可能达不到）

### 2. 带宽

1. **定义：**
   1. 原本是信号具有的频带宽度，即最高频率与最低频率只差，单位是赫兹(Hz)
   2. 网络的“带宽”通常是指数字信道所能传送的“最高数据率”，单位：b/s（bps）

### 3. 延迟或时延

 1. **Q：分组交换为什么会发生丢包和时延？**

    A：分组在路由器缓存中排队

    - 分组到达速率超出输出链路容量
    - 分组排队，等待输出链路可用

    ![丢包和时延](D:\Desktop\Markdown\mocc计算机网络\丢包和时延.png)

 ### 4. 四种分组延迟

1. **d_proc：结点处理延迟**
   - 差错检测
   - 确定输出链路
   - 通常小于<msec
2. **d_queue：排队延迟**
   - 等待输出链路可用
   - 取决于路由去拥塞程度，随机性强
3. **d_trans：传输延迟**
   - L：分组长度
   - R：链路带宽
   - = L/R
4. **d_prop：传播延迟**
   - d:物理链路长度
   - s:信号传播速度（一般为2*10的8次方，光速的0.7倍）
   - = d/s
5. **一个路由到另一个路由的延迟**：d_nodal = d_proc + d_queue + d_trans + d_prop



### 5. 传输延迟和传播延迟完全不同，类比

![传输和传播延迟类比](D:\Desktop\Markdown\mocc计算机网络\传输和传播延迟类比.png)





### 6. 排队延迟

![排队延迟](D:\Desktop\Markdown\mocc计算机网络\排队延迟.png)

### 7. 时延带宽积

1. **定义： 传播时延 * 带宽**
   - 也称为**以比特为单位的链路长度**
   - 通俗意义上，可以理解为，一条链路上容纳了多少bit

<img src="D:\Desktop\Markdown\mocc计算机网络\时延带宽积.png" alt="image-20210405134438857" style="zoom:50%;" />

### 8. 丢包

1. **原因：**
   1. 队列缓存容量有限
   2. 分组到达已满队列将被丢弃
   3. 丢弃分组可能由前序节点或源重发（也可能不重发）
2. 丢包率：丢包数/已发分组总数

### 9. 吞吐量

1. **定义：**表示在发送端和接收端之间，传送数据速率(b/s)
   - 即时吞吐量：给定时刻的速率
   - 平均吞吐量

<img src="D:\Desktop\Markdown\mocc计算机网络\吞吐量1.png" alt="image-20210405135438773" style="zoom:50%;" />

<img src="D:\Desktop\Markdown\mocc计算机网络\吞吐量2.png" alt="image-20210405135852107" style="zoom:50%;" />

- 如果Rs<Rc，则端到端吞吐量是Rs
- 反之则是Rc

2. **瓶颈链路**：端到端路径上，限制端到端吞吐量的链路

<img src="D:\Desktop\Markdown\mocc计算机网络\吞吐量internet场景.png" alt="image-20210405143259941" style="zoom:50%;" />

## 6. 计网体系结构

1. 网络体系结构是从**功能**上描述计算机网络结构（而不是物理构成）
2. 计算机网络体系结构简称网络体系结构，是**分层结构**
3. 每层遵循某个/些**网络协议**完成本层功能
4. **计算机网络体系结构**是计算机网络的各层及其协议的集合
5. 体系结构是一个计算机网络的功能层次及其关系的**定义**
6. 体系结构是**抽象的**

### 1. 分层网络体系结构基本概念

<img src="D:\Desktop\Markdown\mocc计算机网络\分层网络体系基本概念.png" alt="image-20210405144338721" style="zoom:50%;" />

1. **实体**：表示任何可发送或接受信息的硬件或软件进程
2. 协议是控制两个**对等实体**进行通信的规则的集合，协议是**水平的**，（上图中两个系统的实体(n+1)之间使用同一层的协议）
3. 任一层实体需要使用**下层**服务，遵循本层协议，实现本层功能，向**上层**提供服务，服务是**垂直的**
4. 下层协议的实现对上册的服务用户是透明的，n+1层不关心n层如何实现的功能
5. 同系统的相邻层实体间通过**接口**进行交互，通过**服务访问点SAP**（Service Access Point），交换**原语**，指定请求的特定服务

### 2. OSI参考模型

 理论成功，市场失败，是最佳的学习工具

#### 1. 通信过程

<img src="D:\Desktop\Markdown\mocc计算机网络\OSI通信过程.png" alt="image-20210405151553619" style="zoom:50%;" />

1. 实线是实际的传输路径
2. 路由设备只实现下三层，上四层称为端到端层

#### 2. 数据封装

<img src="D:\Desktop\Markdown\mocc计算机网络\数据封装.png" alt="image-20210405154046008" style="zoom:50%;" />

1. 为什么要数据封装：
   - 增加控制信息
     - 构造协议数据单元（PDU）
   - 控制信息主要包括：
     - 地址：标识发送端/接收端
     - 差错检测编码：用于差错检测或纠正
     - 协议控制：实现协议功能的附加信息，如：优先级，服务质量（QoS）和安全控制等

### 3. 物理层

1. **功能**：传输每一个bit

   - **接口特性**
     - 机械，电气，功能，规程
   - **比特编码**
   - **数据率**
   - **比特同步**
     - 时钟同步
   - **传输模式**
     - 单工：只能单向传输（比如电视）
     - 半双工：可以双向，但只能交替进行（比如对讲机）
     - 全双工：发送数据的同时可以接受数据

   ![image-20210405154801955](D:\Desktop\Markdown\mocc计算机网络\物理层.png)

### 4. 数据链路层

1. **功能**：物理层解决了单一bit传输，但这个bit由谁接收，bit出现错误如何纠正，这些问题，由逻辑的数据链路层解决。

   - 负责**结点-结点**的数据传输，数据链路层解决的是物理链路直接相连的，两个相邻节点的数据传输
   - 组帧（加头尾信息）
   - **物理寻址：**
     - 在帧头中增加发送端/接收端的**物理地址**，标识数据帧的发送端/接收端
     - 例如下面，标记数据从20发送，发送给62

   <img src="D:\Desktop\Markdown\mocc计算机网络\物理寻址.png" alt="image-20210405155326285" style="zoom:50%;" />

   - 流量控制
     - 避免淹没接收端
   - 差错控制
     - 检测并重传损坏或丢失帧，并避免重复帧
   - 访问（接入）控制
     - 在任一给定时刻，决定哪个设备拥有链路（物理介质）控制使用权

![](D:\Desktop\Markdown\mocc计算机网络\数据链路层.png)

### 5. 网络层

1. **功能**

   - 负责**源主机到目的主机**数据分组交付

     - 可能穿越多个网络时，物理寻址就不能使用了

   - **逻辑寻址**

     - **全局唯一**逻辑地址，确保数据分组被送达目的主机，如IP地址

   - 路由

     - 路由器（或网关）互联网络，并路由分组至最终目的主机
     - 路径选择

   - 分组换发

     <img src="D:\Desktop\Markdown\mocc计算机网络\网络层.png" alt="image-20210405162815426" style="zoom:50%;" />

     - 可以看到转发过程中，逻辑地址始终是不变的，而物理地址在不同的局域网中会变化

<img src="D:\Desktop\Markdown\mocc计算机网络\网络层1.png" alt="image-20210405163920509" style="zoom:50%;" />

### 6. 传输层

   	1. 功能：负责**源-目的（端-端）（进程间）**完整报文传输
       - 分段与重组
       - SAP寻址：
         - 确保将完整报文提交给正确**进程**，如端口号
       - 端到端的连接控制
       - 端到端的流量控制
       - 端到端的差错控制

<img src="D:\Desktop\Markdown\mocc计算机网络\传输层SAP.png" alt="image-20210405164417360" style="zoom:50%;" />

<img src="D:\Desktop\Markdown\mocc计算机网络\传输层.png" alt="image-20210405163804401" style="zoom:50%;" />

### 7. 会话层

1. 功能：
   - 对话控制
     - 建立，维护
   - 同步
     - 在数据流中插入“同步点”
   - 最薄的一层

![image-20210405164603948](D:\Desktop\Markdown\mocc计算机网络\会话层.png)

### 8. 表示层

1. 功能：处理两个系统间，交换信息的**语法与语义**的问题
   - 数据表示转化（两个主机表示的数据形式可能不同）
     - 转换为主机独立的编码
   - 加密，解密
   - 压缩，解压

![image-20210405164930413](D:\Desktop\Markdown\mocc计算机网络\表示层.png)

### 9. 应用层

​	由于会话层和表示层的功能相对来说较少，因此在网络模型中实际上不是独立存在的，而是在应用层中一起实现的

1. 功能：
   - 支持用户通过用户代理（如浏览器）或网络接口**使用网络（服务）**
   - 典型的应用层服务：FTP文件传输，SMTP电子邮件，Web服务HTTP

<img src="D:\Desktop\Markdown\mocc计算机网络\应用层.png" alt="image-20210405165055467" style="zoom: 67%;" />

### 10. TCP/IP参考模型

<img src="D:\Desktop\Markdown\mocc计算机网络\TCPIP参考模型.png" alt="image-20210405171334439" style="zoom:33%;" />

<img src="D:\Desktop\Markdown\mocc计算机网络\TCPIP参考模型2.png" alt="image-20210405171412634" style="zoom:33%;" />

### 11. 5层参考模型

<img src="D:\Desktop\Markdown\mocc计算机网络\5层模型.png" alt="image-20210405171638270" style="zoom:50%;" />

![image-20210405172358735](D:\Desktop\Markdown\mocc计算机网络\5层数据封装.png)





# 2. 网络应用（应用层）

## 1. 网络应用基本原理

### 1. 网络应用体系结构

1. **客户机/服务器（client-Server，C/S）**

   - 服务器

     - 7*24小时提供服务
     - 永久性访问地址/域名
     - 利用大量服务器实现可扩展性

   - 客户机

     - 与服务器通信，使用其服务
     - 间接性接入网络
     - 可以使用动态IP地址
     - 不会与其他客户机直接通信

     <img src="D:\Desktop\Markdown\mocc计算机网络\C and S结构.png" alt="image-20210418154008805" style="zoom:50%;" />

2. **点对点（Peer-to-peer，P2P）**

   - 特点
     - 没有永远在线的服务器
     - 任意端系统/节点之间可以直接通讯
     - 节点间接性接入网络
     - 节点可能改变IP地址
   - 相较于C/S结构的优缺点
     - 有点：高度可伸缩
     - 缺点：难于管理

3. **混合结构（Hybrid）**

   - 是否能结合上述两种结构，取优避缺
   - 例子：Napster
     - 文件传输使用P2P
     - 文件搜索使用C/S——集中式
       - 每个节点向中央服务器登记自己的内容
       - 每个节点向中央服务器提交查询请求，查找感兴趣的内容

   <img src="D:\Desktop\Markdown\mocc计算机网络\napster混合结构.png" alt="image-20210418154505412" style="zoom:50%;" />



### 2. 网络应用的进程通信

​	构成了网络应用的基础

   	1. **进程：**
       - 主机上运行的程序
       - 同一主机上运行的进程间通信
         - 进程间通信机制
         - 由操作系统提供
       - 不同主机上进程间通信
         - **消息交换**
         - **socket**
       - 客户机进程：发起通信的进程
       - 服务器进程：等待通信请求的进程
  	2. **套接字：Socket**
      - 把网络硬件基础设施以及网络协议栈，抽象为Socket
      - 进程间（不同主机）通信利用socket发送/接受消息
      - 类似于寄信
        - 发送发将消息送到门外邮箱
        - 发送发依赖（门外的）传输基础设施将消息传到接收方所在主机，并送到接收方门外
        - 接收方从门外获取消息
      - 传输基础设施向进程提供API
        - 传输协议的选择
        - 参数的设置
        - 因此网络应用开发称为Socket编程

<img src="D:\Desktop\Markdown\mocc计算机网络\Socket.png" alt="image-20210418155138171" style="zoom:50%;" />

3. **如何寻址进程**
   - 不同主机上进程间通信，每个进程必须拥有**标识符**
   - 如何寻址主机？——**IP地址**
     - Q：主机有了IP后，是否足以定位进程？
     - A：否。同一主机上可能同时有多个进程需要通信。需要端口号
4. **端口号/port number**
   - 为主机上每个需要通信的进程，分配一个端口号
   - 例如：HTTP Server：80；Mail Server：25。
5. **进程的标识符**
   - IP地址+端口号

<img src="D:\Desktop\Markdown\mocc计算机网络\进程间标识符.png" alt="image-20210418160556652" style="zoom:50%;" />

   	5. **应用层协议**
       - 网络应用要遵循应用层协议
       - 公开协议
         - 由RFC（Request for comments）定义
         - 允许互相操作
         - HTTP，SMTP等
       - 私有协议
         - 多数P2P文件共享应用
  	6. **应用层协议的内容**
      - 消息的类型
        - 请求消息
        - 相应消息
      - 语法/格式
        - 消息中有哪些字段（field）
        - 每个字段如何描述
      - 字段的语义
        - 字段中信息的含义
      - 规则
        - 进程何时/如何发送/相应消息



### 3. 网络应用的需求与传输层服务

#### 1. 对传输层服务的需求

 1. 数据丢失/可靠性

    - 某些应用能容忍一定的数据丢失：网络电话
    - 某些要求绝对可靠的数据传输：文件传输，telnet

    2. 时间延迟

    - 有些应用在延迟足够低时才有效
    - 网络电话/游戏

    3. 带宽

    - 有些应用，带宽达到最低要求时才有效，比如视频
    - 某些应用可以适应任何带宽——弹性应用：email

    ![image-20210418161644478](D:\Desktop\Markdown\mocc计算机网络\典型网络应用多传输服务的需求.png)

#### 2. Internet提供的传输服务：TCP和UDP

1. TCP服务
   - 面向连接：C/S进程间需要建立连接
   - 可靠传输
   - 流量控制：发送发不会发送速度过快，超过接收方的处理能力
   - 拥塞控制：网络负载过重时，能够限制发送方的发送速度
   - 不提供时间/延迟保障
   - 不提供最小带宽保障
2. UDP服务
   - 无连接
   - 不可靠传输
   - 不提供：
     - 可靠性保障
     - 流量控制
     - 拥塞控制
     - 延迟保障
     - 带宽保障

<img src="D:\Desktop\Markdown\mocc计算机网络\典型网络应用使用的应用层协议和传输服务.png" alt="image-20210418162140798" style="zoom:50%;" />





## 2. Web应用

### 1. 概述

1. **构成：**
   - 网页
   - 网页互相链接
2. **网页包含多个对象**
   - 对象：HTML文件，JPEG图片，视频文件，动态脚本等
   - 基本HTML文件：包含对其他对象引用的链接
3. **对象的寻址**
   - URL：统一资源定位器
   - 基本格式，**Scheme：//host：port/path**
4. **HTTP协议概述**
   - 超文本传输协议
   - C/S结构
     - 客户-Browser：请求，接受，展示Web对象
     - 服务器-Web Server：响应客户的请求，发送对象
   - 使用TCP传输服务
     - 服务器使用80端口等待客户请求
     - 浏览器发起到服务器的TCP连接（创建套接字Socket）
     - 服务器接受来自浏览器的TCP连接
     - 浏览器（HTTP客户端）与Web服务器（HTTP服务器）交换HTTP消息
     - 关闭TCP连接
   - 无状态
     - 服务器不维护任何有关客户端过去所发请求的信息
     - 有状态的协议更复杂
       - 维护状态（历史信息
       - 如果客户或服务器失效，会产生状态的不一致，解决这种不一致的代价很高

### 2. HTTP连接

1. **连接的两种类型**

   - 非持久性连接
     - 每个TCP连接最多允许传输**一个**对象
     - HTTP1.0使用非持久性连接
   - 持久性连接
     - 每个TCP连接允许传输**多个**对象
     - HTTP1.1默认使用持久性连接

2. **非持久性连接**

   - 连接过程

     <img src="D:\Desktop\Markdown\mocc计算机网络\非持久连接1.png" alt="image-20210418170327038" style="zoom:50%;" />

     <img src="D:\Desktop\Markdown\mocc计算机网络\非持久连接2.png" alt="image-20210418170451787" style="zoom:50%;" />

   - 时间分析建模

     <img src="D:\Desktop\Markdown\mocc计算机网络\非持久连接响应时间.png" alt="image-20210418170837706" style="zoom:50%;" />

   - 非持久连接的问题：

     - 每个对象需要两个RTT
     - 操作系统需要为每个TCP连接开销资源
     - 浏览器的做法：
       - 打开多个并行的TCP连接以获取网页所需对象
       - 就给服务器造成负担

3. **持久性连接**

   - 发送相应后，服务器保持TCP连接的打开
   - 后续的HTTP消息，可以通过这个连接
   - 又可以分为有流水的和无流水的持久性连接
   - **无流水的持久性连接**
     - 客户端只有收到前一个响应后，才发送新的请求
     - 每个被引用的对象，耗时1个RTT
   - **流水的持久性连接**
     - HTTP 1.1默认选项
     - 客户端只要遇到一个引用对象，就尽快发出请求
     - 理想情况下，收到所有的引用对象，只需要耗时约一个RTT



### 3. HTTP消息格式

​	HTTP有两类消息：请求和响应

1. **请求消息**
   - ACSII：人直接可读

<img src="D:\Desktop\Markdown\mocc计算机网络\HTTP请求消息示例.png" alt="image-20210419171837574" style="zoom:50%;" />

2. **HTTP请求消息的通用格式**
   1. sp空格，cr回车，if换行

<img src="D:\Desktop\Markdown\mocc计算机网络\HTTP请求通用格式.png" alt="image-20210419172024137" style="zoom: 33%;" />

3. **上传输入的方法**
   - **POST方法**
     - 网页经常需要填写表格
     - 在请求消息的消息体中，上传客户端的输入
   - **URL方法**
     - 使用**GET方法**
     - 输入信息通过requeset行的URL字段上传
4. **HTTP方法的类型**
   - HTTP1.0
     - GET
     - POST
     - HEAD
       - 请Server不要将所请求的对象放入响应消息中
   - HTTP1.1
     - GET,POST,HEAD
     - PUT
       - 将消息体中的文件上传到URL字段所指定的路径
     - DELETE
       - 删除URL字段所指定的文件





-------

1. **响应消息**

   <img src="D:\Desktop\Markdown\mocc计算机网络\HTTP响应消息.png" alt="image-20210419173718880" style="zoom:50%;" />

2. 响应状态码：
   - 响应消息的第一行
   - 示例
     - 200 OK
     - 301 Moved Permanently
     - 400 Bad Request
     - 404 Not Found
     - 505 HTTP Version Not Supported

### 4. Cookie技术

1. Q：为什么需要Cookie？

   A：HTTP协议无状态。但是很多应用需要服务器掌握客户端的状态，如购物车。 

2. **Cookie技术**

   - 某些网站为了辨别用户身份、进行session跟踪而储存在用户本地终端上的数据（通常经过加密）

3. **Cookie的组件**

   - HTTP响应消息的cookie头部行
   - HTTP请求消息的cooike头部行
   - 保存在客户端主机上的cookie文件，由浏览器管理
   - Web服务器端的后台数据库

4. **Cookie的原理**

   <img src="D:\Desktop\Markdown\mocc计算机网络\Cookie原理.png" alt="image-20210419175706067" style="zoom:50%;" />

5. **Cookie能用于：**
   1. 身份认证
   2. 购物车
   3. 推荐
   4. Web email
   5. 等等

6. **Cookie存在隐私问题**
   
   1. 各大公司开始研制cookie的替代技术 

### 4. Web缓存/代理服务器技术

 	1. **功能**
          
     - 在不访问服务器的前提下，满足客户端的HTTP请求
	2. **发明原因（改善性能，cookie解决的是功能上的问题）**

    - 缩短客户请求的响应时间
    - 见啥机构/组织的流量
    - 在大范围内实现有效的内容分发
    3. **Web缓存/代理服务器**
    - 用户设定浏览器通过缓存进行Web访问
    - 浏览器向缓存/代理服务器发送所有的HTTP请求
      - 如果所请求的对象在缓存中，缓存返回对象
      - 否则，缓存服务器向原始服务器发送HTTP请求，获取对象，返回给客户端并且保存
    - 缓存既充当客户端，也充当服务器
    - 一般由IPS（Internet服务提供商）架设

4. **示例**

<img src="D:\Desktop\Markdown\mocc计算机网络\Web缓存示例1" alt="image-20210419181948441" style="zoom: 33%;" />

接入互联网的链路利用率越高，访问延迟越大

<img src="D:\Desktop\Markdown\mocc计算机网络\Web缓存示例2" alt="image-20210419182126930" style="zoom: 33%;" />

<img src="D:\Desktop\Markdown\mocc计算机网络\Web缓存示例3" alt="image-20210419182351077" style="zoom:33%;" />

5. 条件性GET方法
   - 为了实现缓存一致性，即缓存中的数据和原始服务器中的对应数据是相同的
   - 目标
     - 如果缓存有最新的版本，则不需要发送请求对象
   - 缓存
     - 在HTTP请求消息中，声明所持有的版本日期
     - if-modified-since：<date>
   - 服务器
     - 如果缓存的版本是最新的，则响应消息中不包含对象
     - HTTP1.0 304 Not Modified

<img src="D:\Desktop\Markdown\mocc计算机网络\条件性GET.png" alt="image-20210419182953202" style="zoom:33%;" />



## 3. Email应用

### 1. 概述

1. **构成组件**

   - 邮件客户端
   - 邮件服务器
   - SMTP协议（Simple Mail Transfer Protocal） 

2. **邮件客户端**

   - 读，写消息
   - 与服务器交互，收，发消息
   - 例如Outlook，Foxmail，Web浏览器

3. **邮件服务器**

   - 邮箱：存储发给该用户的Email
   - 消息队列：存储等待发送的Email 
   - 为什么需要邮件服务器
     - 因为收发email双方不能保证对方一直在线，如果双方直接发消息的话，有一方不在线，就无法接受消息

4. **SMTP协议**

   - 邮件服务器之间传递消息所使用的协议
   - 客户端：发送消息的服务器
   - 服务器：接收消息的服务器
   - 使用TCP进行email消息的可靠传输
   - 端口25
   - 传输过程的三个阶段
     - 握手
     - 消息的传输
     - 关闭
   - 命令/响应交互模式
     - 命令：ASCII文本
     - 响应：状态代码和语句
   - Email消息只能包含7位ASCII码
   - 使用持久性连接
   - SMTP服务器利用CRLF.CRLF确定消息的结束
   - 与HTTP对比：
     - HTTP：拉式
     - SMTP：退式
     - 都使用命令/响应交互模式
     - 命令和状态代码都是ASCII码
     - HTTP：每个对象封装在独立的响应消息中
     - SMTP：多个对象在由多个部分构成的消息中发送

5. **SMTP交互示例**

   S和C是两个服务器

   <img src="D:\Desktop\Markdown\mocc计算机网络\SMTP交互.png" alt="image-20210419184912817" style="zoom:50%;" />

### 2. Email消息格式

1. **格式**
   - 头部行（与SMTP命令不同
     - To
     - From
     - Subject
   - 消息体
     - 消息本身
     - 只能是ASCII字符
2. **MIME：多媒体邮件扩展**
   - 通过在邮件头部增加额外的行，以声明MIME的内容类型
   - <img src="D:\Desktop\Markdown\mocc计算机网络\MIME.png" alt="image-20210419190506338" style="zoom:50%;" />
3. **邮件访问协议**
   - 从服务器获取邮件
     - POP：Post Office Protocol
       - 认证/授权（客户端——服务器）和下载
     - IMAP：Internet Mail Access Protocol
       - 更多功能
       - 更加复杂
       - 能够操作服务器上村粗的消息
     - HTTP：163，QQ Mail等

<img src="D:\Desktop\Markdown\mocc计算机网络\邮件访问协议" alt="image-20210419190708519" style="zoom:50%;" />

4. **POP协议**

    <img src="D:\Desktop\Markdown\mocc计算机网络\POP1.png" alt="image-20210419191003024" style="zoom:50%;" />

   ![image-20210419191139258](D:\Desktop\Markdown\mocc计算机网络\pop)

   5. **IMAP协议**

      <img src="D:\Desktop\Markdown\mocc计算机网络\IMAP.png" alt="image-20210419191308958" style="zoom:50%;" />

